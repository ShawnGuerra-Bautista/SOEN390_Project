language: android
jdk: oraclejdk8

android:
  components:
  - tools
  - build-tools-28.0.3
  - android-27
  - extra-android-m2repository

before_install:
- yes | sdkmanager "platforms;android-27"
- chmod +x gradlew

#script:
#- ./gradlew build jacocoTestReport
#- ./gradlew test
#- ./gradlew testDebug


jobs:
  include:
  # build of app without any other task
  - stage: "Build"
    language: android
    script: ./gradlew assemble

# After Build, run all our tests first to ensure we wrote passing tests
  # run Release 1 Tests Only
  - stage: "Release 1 Tests"
    language: android
    script: ./gradlew cleanTest testDebugUnitTest --tests com.fsck.k9._390Tests.Release1* --debug

  # run Release 2 Tests Only
  - stage: "Release 2 Tests"
    language: android
    script: ./gradlew cleanTest testDebugUnitTest --tests com.fsck.k9._390Tests.Release2* --debug

  # run Release 3 Tests Only
  - stage: "Release 3 tests"
    language: android
    script: ./gradlew cleanTest testDebugUnitTest --tests com.fsck.k9._390Tests.Release3* --debug

  # runs all tests
  - stage: "All Tests"
    language: android
    script: ./gradlew test testDebugUnitTest

  # static analysis using Android lint
  - stage: "Static Analysis"
    language: android
    script: ./gradlew lint

  # runs static analysis
  - stage: "Test Coverage"
    language: android
    script: ./gradlew jacocoTestReport
    after_success:
    - bash <(curl -s https://codecov.io/bash)


